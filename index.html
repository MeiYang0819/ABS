<!doctype html>
<html lang="zh-Hant">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ¶äº’å‹•éŸ³ç¬¦</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* === ç«™å…§é…è‰²èˆ‡æ¬„å¯¬ï¼ˆæœ€å¸¸æ”¹ï¼‰=== */
/* âœ… å¯èª¿æ•´ï¼šä¸»é…è‰²ã€æ¬„å¯¬ã€é™°å½±ã€é–“è· */
:root{
  --brand:#D4BFAA;     /* âœ… å¯èª¿æ•´ï¼šé é¢èƒŒæ™¯ä¸»è‰² */
  --title:#A68A7C;     /* âœ… å¯èª¿æ•´ï¼šæ¨™é¡Œå­—è‰² */
  --neutral:#E4E4E4;   /* âœ… å¯èª¿æ•´ï¼šé¢æ¿åº•è‰²/é‚Šæ¡†è‰² */
  --soft:#F5F1EC;      /* âœ… å¯èª¿æ•´ï¼šç‹€æ…‹åˆ—/éµç›¤åº•è‰² */
  --accent:#BFA5A0;    /* âœ… å¯èª¿æ•´ï¼šé‡é»æ–‡å­—é¡è‰² */
  --rim:#E4E4E4;       /* âœ… å¯èª¿æ•´ï¼šè¼¸å…¥æ¡†é‚Šæ¡†è‰² */
  --ink:#0f172a;       /* âœ… å¯èª¿æ•´ï¼šå…§æ–‡å­—è‰² */

  /* âœ… å¯èª¿æ•´ï¼šå„æ¬„ä½å¯¬åº¦ï¼ˆæ¡Œæ©Ÿï¼‰ */
  --w-displayName: 96px;
  --w-email: 261px;
  --w-code: 96px;
  --w-instrument: 96px;
  --w-lastNote: 125px;
  --w-lastNote-m: 160px;

  /* âœ… å¯èª¿æ•´ï¼šæ’ç‰ˆé–“è· */
  --label-w:88px;   /* æ¨™ç±¤å¯¬ */
  --gap:10px;       /* æ¬„é–“è· */
  --kb-h:280px;     /* æ¨‚å™¨é«˜åº¦ */
  --sep:2px;        /* ç™½éµåˆ†éš”ç·šå¯¬ */

  /* ğŸ§© é€²éšå¯èª¿ï¼šæ•´é«”æé‚Š/é«˜å…‰ï¼ˆæ”¹äº†æœƒå½±éŸ¿å…¨ç«™è¦–è¦ºï¼‰ */
  --stroke:rgba(0,0,0,.18);
  --glow:rgba(255,255,255,.65);

  /* âœ… å¯èª¿æ•´ï¼šæç¤ºæŒ‰éˆ•èˆ‡å‚™è¨»å­—ç´š */
  --w-hintbtn: 160px; /* èªªæ˜æŒ‰éˆ•å¯¬åº¦ */
  --hint-fz: 12px;    /* å‚™è¨»å­—é«”å¤§å° */
  --hint-maxw: 520px; /* å‚™è¨»æœ€å¤§å¯¬åº¦ */
}

/* === å…¨ç«™å­—é«”èˆ‡ç²—ç´°ï¼ˆå¸¸æ”¹ï¼‰=== */
/* ğŸ§© é€²éšå¯èª¿ï¼šè‹¥æƒ³é—œé–‰æ•´ç«™ç²—é«”/æé‚Šï¼Œæ”¹é€™è£¡ */
*{ box-sizing:border-box; font-family:"Zen Maru Gothic","Noto Sans TC",system-ui,-apple-system,sans-serif !important; -webkit-text-stroke:.35px var(--stroke); text-shadow:0 1px 0 var(--glow); }
html,body{ margin:0; color:var(--ink); background:var(--brand); font-weight:700; }
/* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šæ“ä½œèªªæ˜ç¶­æŒåŸæ¨£ï¼ˆä¸ç²—é«”ï¼‰ */
#guideOverlay .dialog, #guideOverlay .dialog *{ font-weight:500 !important; -webkit-text-stroke:0 !important; text-shadow:none !important; }

/* === ç‰ˆé¢å®¹å™¨ï¼ˆæ¬¡å¸¸æ”¹ï¼‰=== */
/* âœ… å¯èª¿æ•´ï¼šå¤–æ¡†ã€åœ“è§’ã€é™°å½± */
.bg-notes{ position:fixed; inset:0; width:100%; height:100%; object-fit:cover; opacity:.60; mix-blend-mode:multiply; filter:contrast(1.1); pointer-events:none; z-index:0; }
.panel{ position:relative; z-index:1; max-width:1060px; margin:22px auto; background:var(--neutral); border:1px solid var(--neutral); border-radius:16px; padding:18px 18px 26px; box-shadow:0 10px 26px rgba(0,0,0,.10); backdrop-filter:blur(8px) saturate(115%); }

/* === æ¨™é¡Œï¼ˆæ¬¡å¸¸æ”¹ï¼‰=== */
/* âœ… å¯èª¿æ•´ï¼šå­—ç´šã€é™°å½±ã€æé‚Š */
h2{ margin:4px 0 20px; text-align:center; font-size:2.8rem; font-weight:700; letter-spacing:1px; color:var(--title); -webkit-text-stroke:.6px rgba(0,0,0,.12); text-shadow:0 3px 4px rgba(255,255,255,.75); }

/* === è¡¨å–®åˆ—ï¼ˆå¸¸æ”¹ï¼‰=== */
/* âœ… å¯èª¿æ•´ï¼šæ¬„ä½é«˜åº¦ã€åœ“è§’ã€é™°å½± */
.row{ display:flex; gap:var(--gap); align-items:center; flex-wrap:wrap; margin-top:10px; }
.row label{ width:var(--label-w); opacity:.92; white-space:nowrap; font-weight:700; -webkit-text-stroke:0; text-shadow:none; }
.row input,.row select,.row button{
  height:38px; font-size:14px; background:#fff; padding:8px 10px; border:1px solid var(--rim); border-radius:10px;
  -webkit-text-stroke:.25px rgba(0,0,0,.12); text-shadow:0 1px 0 rgba(255,255,255,.5);
}
/* âœ… å¯èª¿æ•´ï¼šå¾®ç«‹é«”é™°å½± */
.row input,.row select{ box-shadow: 0 2px 0 rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.04); }

/* æ¬„ä½å¯¬åº¦ï¼ˆå¸¸æ”¹ï¼‰*/
#displayName{ width:var(--w-displayName); }  /* âœ… å¯èª¿æ•´ */
#email{ width:var(--w-email); }              /* âœ… å¯èª¿æ•´ */
#code{ width:var(--w-code); }                /* âœ… å¯èª¿æ•´ */
#instrument{ width:var(--w-instrument); }    /* âœ… å¯èª¿æ•´ */
#lastNote{ width:var(--w-lastNote); text-align:center; letter-spacing:.3px; } /* âœ… å¯èª¿æ•´ */
#lastNote::placeholder{ text-align:center; }

/* ã€ŒéŸ³ç¬¦ç´€éŒ„ã€èˆ‡ä¸Šæ–¹ã€Œé›»å­éƒµä»¶ã€å·¦ç·£å°é½Šï¼ˆæ¡Œæ©Ÿï¼‰ */
@media (min-width: 861px){ .align-to-email{ margin-left: calc(var(--w-displayName) - var(--w-instrument)); } } /* âœ… å¯èª¿æ•´ */

/* === æŒ‰éˆ•ï¼ˆå¸¸æ”¹ï¼‰=== */
.row select option{text-align:center}
.row button{
  width:120px; cursor:pointer; font-weight:700;
  transition: transform .08s ease, box-shadow .08s ease, filter .08s ease;
  box-shadow: 0 2px 0 rgba(0,0,0,.15), 0 2px 8px rgba(0,0,0,.06);
}
.btn-compact{ width:60px !important; } /* âœ… å¯èª¿æ•´ï¼šç¸®ç‰ˆæŒ‰éˆ•å¯¬åº¦ */

/* NEW: èªªæ˜æŒ‰éˆ•ï¼ˆè«‹é»æˆ‘ï¼‰å¯è‡ªè¨‚å¯¬åº¦ï¼Œç¶­æŒåŒé«˜åº¦ */
#hintBtn{ width: var(--w-hintbtn) !important; } /* âœ… å¯èª¿æ•´ */

/* äº’å‹•ç‹€æ…‹ */
/* âœ… å¯èª¿æ•´ï¼šäº’å‹•è¦–è¦ºï¼ˆæ”¹é™°å½±/ç¸®æ”¾ï¼‰ */
.row button:disabled{ opacity:.55; cursor:not-allowed; }
.row button:active, .row button.pressed{ transform: translateY(1px) scale(.99); box-shadow: 0 1px 0 rgba(0,0,0,.18), 0 1px 4px rgba(0,0,0,.06); filter: brightness(.98); }

/* === ç‹€æ…‹åˆ—ï¼ˆå¸¸æ”¹ï¼‰=== */
/* âœ… å¯èª¿æ•´ï¼šç‹€æ…‹åˆ—å¤–è§€ */
#status{
  background: var(--soft); border:1px solid var(--neutral); border-radius:12px; padding:10px; margin-top:10px; font-size:14px;
  white-space:pre-wrap; text-align:center; color: var(--accent) !important; font-weight:700;
  -webkit-text-stroke:.35px rgba(0,0,0,.10);
  text-shadow:0 1px 0 rgba(255,255,255,.85), 0 3px 6px rgba(0,0,0,.04);
}
#status.ok,#status.busy,#status.err{
  color: var(--accent) !important; font-weight:700; -webkit-text-stroke:.35px rgba(0,0,0,.10);
  text-shadow:0 1px 0 rgba(255,255,255,.85), 0 3px 6px rgba(0,0,0,.04);
}

/* === NEW: å‚™è¨»å°æµ®å±¤ï¼ˆèˆ‡é–å®šåŒæ’ï¼ŒæŒ‰éˆ•é»æ“Šå¾Œé¡¯ç¤ºï¼‰ === */
/* âœ… å¯èª¿æ•´ï¼šæµ®å±¤å¯¬ã€é™°å½±ã€ä½ç½® */
.actions-inline{ display:flex; gap:var(--gap); position:relative; }
.hint-popover{
  position:absolute; right:0; top:44px;
  z-index:50;
  max-width: var(--hint-maxw); min-width: 260px;
  padding:10px 12px;
  font-size:var(--hint-fz); line-height:1.45; color:var(--accent);
  background:#fff; border:1px solid var(--accent); border-radius:12px;
  box-shadow:0 8px 24px rgba(0,0,0,.10), 0 2px 8px rgba(0,0,0,.06);
  display:none; white-space:normal;
  --arrow-x: calc(100% - 24px); /* ğŸ§© é€²éšå¯èª¿ï¼šç®­é ­é è¨­ä½ç½® */
}
.hint-popover.show{ display:block; }
/* âœ… å¯èª¿æ•´ï¼šç®­é ­æ¨£å¼ */
.hint-popover::before{
  content:""; position:absolute; left:var(--arrow-x); top:-8px;
  transform:translateX(-50%);
  width:0; height:0; border-left:8px solid transparent; border-right:8px solid transparent; border-bottom:8px solid var(--accent);
}
.hint-popover::after{
  content:""; position:absolute; left:var(--arrow-x); top:-7px;
  transform:translateX(-50%);
  width:0; height:0; border-left:7px solid transparent; border-right:7px solid transparent; border-bottom:7px solid #fff;
}

/* === éµç›¤å®¹å™¨ï¼ˆæ¬¡å¸¸æ”¹ï¼‰=== */
/* âœ… å¯èª¿æ•´ï¼šé‚Šæ¡†/åœ“è§’ */
.kb-wrap{ overflow-x:auto; -webkit-overflow-scrolling:touch; background:var(--soft); border:1px solid var(--rim); border-radius:14px; margin-top:14px; }
#keyboard{ position:relative; height:var(--kb-h); user-select:none; -webkit-user-select:none; touch-action: pan-x pan-y; }

/* === é‹¼ç´æ¨£å¼ï¼ˆå¹¾ä¹ä¸æ”¹ï¼‰=== */
/* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šç´°ç·»å…‰å½±æ¯”ä¾‹ï¼Œæ”¹äº†éŸ³æ„Ÿè¦ºæ˜“å¤±è¡¡ */
.white{ position:absolute; bottom:0; height:100%; background:linear-gradient(#ffffff,#eceef3 72%,#d9dde5); border-radius:0 0 12px 12px; box-shadow:inset 0 -12px 16px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.9), 0 1px 0 rgba(0,0,0,.04); }
.white::after{ content:""; position:absolute; top:0; bottom:0; right:0; width:var(--sep); background:linear-gradient(transparent,#cfd3dc 50%,transparent); }
.white:first-child::before{ content:""; position:absolute; top:0; bottom:0; left:0; width:var(--sep); background:linear-gradient(transparent,#cfd3dc 50%,transparent); }
.white.active{ filter:brightness(1.06); }
.black{ position:absolute; bottom:38%; height:62%; background:linear-gradient(#2d2f36,#0e0f13); border:1px solid #0b0d11; border-top:none; border-radius:0 0 10px 10px; z-index:5; box-shadow:inset 0 -6px 10px rgba(0,0,0,.45), 0 3px 10px rgba(0,0,0,.35); transform: translateX(-50%); }
.black.active{ filter:brightness(1.22); }

/* === å‰ä»–æ¨£å¼ï¼ˆå¹¾ä¹ä¸æ”¹ï¼‰=== */
/* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šå…‰å½±/çµæ§‹å’Œé»æ“Šå€å·²èª¿æ ¡ */
.fretboard{ position:relative; display:grid; grid-template-columns: repeat(13, 1fr); width:100%; height:var(--kb-h); background:linear-gradient(180deg,#6b4f2e 0%, #5b4429 50%, #533c24 100%); border-radius:12px; box-shadow:inset 0 10px 20px rgba(0,0,0,.25), inset 0 -8px 16px rgba(0,0,0,.2); }
.head{ position:absolute; left:0; top:0; bottom:0; width:86px; z-index:2; background:linear-gradient(180deg, rgba(0,0,0,.12), transparent 40%),linear-gradient(180deg,#7a5534 0%, #6b4f2e 55%, #5a3f24 100%); box-shadow: inset -8px 0 16px rgba(0,0,0,.18); border-radius:12px 0 0 12px; pointer-events:none; }
.nut{ position:absolute; left:86px; top:0; bottom:0; width:8px; z-index:3; background:linear-gradient(180deg,#e5e1d6,#c9c5ba); box-shadow: inset -1px 0 0 rgba(0,0,0,.35), inset 1px 0 0 rgba(255,255,255,.6); border-right:2px solid rgba(120,120,120,.5); pointer-events:none; }
.bridge{ position:absolute; right:0; top:0; bottom:0; width:10px; z-index:2; background:linear-gradient(180deg,#b9b6ad,#8f8c83); box-shadow: inset 1px 0 0 rgba(255,255,255,.5), inset -1px 0 0 rgba(0,0,0,.25); pointer-events:none; border-left:1px solid rgba(0,0,0,.18); }
.fret-col{ position:relative; background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02)); box-shadow: inset -2px 0 0 rgba(255,255,255,.18), inset -4px 0 0 rgba(0,0,0,.28); }
/* å¼¦ç¹ç´‹èˆ‡é«˜å…‰ */
.string{ --sw:2px; position:absolute; left:94px; right:0; height:0; z-index:3; border-top: var(--sw) solid transparent; transform-origin:center; filter:drop-shadow(0 1px 0 rgba(0,0,0,.18)); background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.45) 50%, rgba(255,255,255,0) 100%); background-size:160px 1px; background-repeat:no-repeat; background-position:-160px 0; }
.string::before{ content:""; position:absolute; left:0; right:0; top: calc(var(--sw) * -0.5); height: var(--sw); background: repeating-linear-gradient(90deg, #caa56b 0 2.4px, #906a3d 2.4px 3.1px), repeating-linear-gradient(90deg, rgba(255,255,255,.08) 0 2.4px, rgba(0,0,0,.10) 2.4px 3.1px), linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.15) 55%, rgba(0,0,0,.18) 100%); border-radius:999px; opacity:.98; pointer-events:none; }
.string::after{ content:""; position:absolute; left:0; right:0; top: calc(var(--sw) * -0.5 + 0.2px); height: calc(var(--sw) * .25); background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,0)); pointer-events:none; border-radius:999px; opacity:.9; }
.string[data-s="2"]{ --sw:2.5px; }
.string[data-s="3"]{ --sw:3px; }
.string[data-s="4"]{ --sw:3.5px; }
.string[data-s="5"]{ --sw:4px; }
.head-line{ --sw:2px; position:absolute; left:0; width:86px; height:0; z-index:2; border-top: var(--sw) solid transparent; filter:drop-shadow(0 1px 0 rgba(0,0,0,.06)); pointer-events:none; }
.head-line::before{ content:""; position:absolute; left:0; right:0; top: calc(var(--sw) * -0.5); height: var(--sw); background: repeating-linear-gradient(90deg, #caa56b 0 2.4px, #906a3d 2.4px 3.1px), repeating-linear-gradient(90deg, rgba(255,255,255,.08) 0 2.4px, rgba(0,0,0,.10) 2.4px 3.1px), linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,0)); border-radius:999px; opacity:.98; }
.head-line::after{ content:""; position:absolute; left:0; right:0; top: calc(var(--sw) * -0.5 + 0.2px); height: calc(var(--sw) * .25); background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,0)); border-radius:999px; opacity:.9; }
.head-line[data-s="2"]{ --sw:2.5px; }
.head-line[data-s="3"]{ --sw:3px; }
.head-line[data-s="4"]{ --sw:3.5px; }
.head-line[data-s="5"]{ --sw:4px; }

/* è§¸æ§å€èˆ‡éœ‡å‹•å‹•ç•«ï¼ˆå¹¾ä¹ä¸æ”¹ï¼‰ */
/* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šé»æ“Š/å‹•ç•«ç¯€å¥ */
.hit-row{ position:absolute; left:0; right:0; height:28px; transform:translateY(-50%); background:transparent; cursor:pointer; z-index:4; }
@media (pointer:coarse){ .hit-row{ height:34px; } }
.string.vibrate{ animation: vibrCurve 360ms ease-out, shine 360ms ease-out; }
@keyframes vibrCurve{ 0%{transform:translateY(0)} 10%{transform:translateY(-3.2px)} 20%{transform:translateY(0)} 30%{transform:translateY(2.6px)} 45%{transform:translateY(0)} 60%{transform:translateY(-1.8px)} 75%{transform:translateY(0.6px)} 100%{transform:translateY(0)} }
@keyframes shine{ 0%{ background-position:-160px 0; opacity:.95 } 100%{ background-position:160px 0; opacity:.96 } }

/* === Overlayï¼ˆå…©å€‹å½ˆè·³è¦–çª—æ¨£å¼ï¼Œå¶çˆ¾æœƒæ”¹ï¼‰=== */
/* âœ… å¯èª¿æ•´ï¼šé®ç½©é€æ˜åº¦ã€åœ“è§’ã€é™°å½± */
.overlay{ position:fixed; inset:0; z-index:9999; display:flex; align-items:center; justify-content:center; background:rgba(17,24,39,.35); backdrop-filter:blur(3px); pointer-events:auto; }
.overlay.hidden{ display:none; }
.dialog{ min-width:300px; max-width:92vw; background:var(--soft); border:1px solid var(--neutral); border-radius:14px; padding:18px; box-shadow:0 18px 44px rgba(0,0,0,.18); text-align:center; pointer-events:auto; }
.dialog h3{ margin:0 0 8px; font-size:18px; color:#6b5e52; }
.dialog p.ios-hint{ margin:6px 0; line-height:1.6; font-size:13px; color:#d11; }
.dialog .actions{ display:flex; gap:10px; justify-content:center; margin-top:12px; }
.dialog button{ width:120px; height:38px; border-radius:10px; border:1px solid var(--rim); background:#fff; cursor:pointer; font-weight:700; }
.dialog button.primary{ background:#fff; }

#lockScreen{ position:fixed; inset:0; z-index:9998; display:none; background:transparent; }

footer{ max-width:1060px;margin:8px auto 22px; text-align:center; color:#6b5e52; font-size:12px; opacity:.9; }

/* === æ‰‹æ©Ÿç›´å‘ï¼ˆåªèª¿æ•´ç›´å‘ï¼Œä¸å‹•å…¶ä»–ï¼‰=== */
/* âœ… å¯èª¿æ•´ï¼šç›´å‘æ’ç‰ˆæ¯”ä¾‹ */
@media (orientation:portrait){
  .row-line2, .row-line3{ width:100%; gap:12px; }
  .pair{ display:flex; align-items:center; gap:var(--gap); width:100%; }
  .actions-inline{ display:flex; gap:var(--gap); }
  .row-line2 .pair, .row-line3 .pair, .row-line3 .actions-inline{ flex: 0 0 100%; }
  .align-to-email{ margin-left:0 !important; }
  #lastNote{ width:var(--w-lastNote-m); }
}
</style>

<body>
  <!-- === èƒŒæ™¯åœ–ï¼ˆæ¬¡å¸¸æ”¹ï¼‰=== -->
  <!-- âœ… å¯èª¿æ•´ï¼šèƒŒæ™¯åœ–æª”æ¡ˆ/ç‰ˆæœ¬ -->
  <img class="bg-notes" src="./assets/notes.png?v=4" alt="">
  <div class="panel">
    <h2>ğŸ¼äº’å‹•éŸ³ç¬¦ğŸ¼</h2>

    <!-- === ç¬¬ 1 è¡Œï¼ˆå§“å / Email / ä»£è™Ÿï¼‰=== -->
    <div class="row row-line2">
      <div class="pair">
        <label for="displayName">è¦ªå‹å§“åï¼š</label>
        <input id="displayName" placeholder="ä¾‹ï¼šå¼µå’©æš" />
      </div>
      <div class="pair">
        <label for="email">é›»å­éƒµä»¶ï¼š</label>
        <input id="email" placeholder="hey fill in your@email" inputmode="email" />
        <!-- âœ… å¯èª¿æ•´ï¼ˆJS æœƒå‹•æ…‹å¡é¸é …ï¼‰ï¼šå¸¸è¦‹ç¶²åŸŸé¸å–® -->
        <datalist id="emailDomains"></datalist>
      </div>
      <div class="pair">
        <label for="code">å–å¾—ä»£è™Ÿï¼š</label>
        <input id="code" placeholder="è«‹è¼¸å…¥ä»£è™Ÿ" />
      </div>
    </div>

    <!-- === ç¬¬ 2 è¡Œï¼ˆæ¨‚å™¨ / éŸ³ç¬¦ç´€éŒ„ / é‡è¨­ / é–å®š + èªªæ˜æŒ‰éˆ•ï¼‰=== -->
    <div class="row row-line3">
      <div class="pair">
        <label for="instrument">æ¨‚å™¨è½‰æ›ï¼š</label>
        <select id="instrument">
          <option value="piano" selected>é‹¼ç´</option>
          <option value="guitar">å‰ä»–</option>
        </select>
      </div>

      <div class="pair">
        <label for="lastNote" class="align-to-email">éŸ³ç¬¦ç´€éŒ„ï¼š</label>
        <input id="lastNote" placeholder="â€” , â€” , â€”" readonly />
      </div>

      <div class="actions-inline">
        <button id="resetBtn" type="button" class="btn-compact">é‡è¨­</button>
        <button id="lockBtn" type="button" class="btn-compact" disabled>é–å®š</button>
        <!-- NEWï¼šèˆ‡é–å®šåŒæ’çš„èªªæ˜è§¸ç™¼æŒ‰éˆ• -->
        <button id="hintBtn" type="button" class="btn-compact" aria-expanded="false" aria-controls="hintPopover" title="é»æˆ‘æŸ¥çœ‹å‚™è¨»">å…ˆé»æˆ‘æŸ¥çœ‹å¥½å’ªğŸ¥º</button>
        <!-- NEWï¼šå‚™è¨»å°æµ®å±¤ -->
        <div id="hintPopover" class="hint-popover" role="note" aria-live="polite">
          æŒ‰ã€Œé–å®šã€å¾Œè«‹ç¨å€™ï¼Œæœ¬äººæœ‰ç¼ºé™·å°è‡´é€Ÿåº¦è¼ƒæ…¢ğŸ¥²<br>
          ç¢ºèªé€å‡ºæˆåŠŸï¼Œä¸‹æ–¹ã€Œç‹€æ…‹åˆ—ã€æœƒç«‹å³é€šçŸ¥æ‚¨æºœğŸ‰
        </div>
      </div>
    </div>

    <!-- === ç‹€æ…‹åˆ— === -->
    <p id="status">å°šæœªåˆå§‹åŒ–</p>

    <!-- === æ¨‚å™¨å®¹å™¨ === -->
    <div class="kb-wrap"><div id="keyboard"></div></div>
  </div>

  <!-- === å½ˆè·³è¦–çª— â‘ ï¼šæ“ä½œèªªæ˜ï¼ˆæœ€å…ˆçœ‹åˆ°ï¼‰=== -->
  <div id="guideOverlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="guideTitle">
    <div class="dialog">
      <h3 id="guideTitle">ğŸ“æ“ä½œèªªæ˜ğŸ“</h3>
      <p>ğŸ”»å¡«å…¥å§“åã€Emailèˆ‡å–å¾—çš„ä»£è™Ÿ</p><p>â†“</p>
      <p>ğŸ”»å¯é¸æ“‡é‹¼ç´æˆ–å‰ä»–ä¸­çš„ä¸‰å€‹éŸ³éš</p><p>â†“</p>
      <p>ğŸ”»ä¸‰å€‹éŸ³éšç¢ºèªå¾Œï¼Œä¸€å®šè¦æŒ‰é–å®š</p><p>â†“</p>
      <p>ğŸ”»é–å®šå®Œæˆå¾Œï¼Œæœƒæœ‰é€šçŸ¥æ˜¯å¦æˆåŠŸ</p><p>â†“</p>
      <p>ğŸ”ºè‹¥æˆåŠŸå³å¯é€€å‡ºä»‹é¢ï¼›åä¹‹å†è©¦</p><p>â†“</p>
      <p>â—ï¸æ²’æŒ‰é–å®šå°±æ˜¯æ²’æœ‰é€å‡ºå°±æ˜¯å½ˆå€‹å¯‚å¯</p>
      <div class="actions"><button id="guideOk" class="primary">äº†è§£</button></div>
    </div>
  </div>

  <!-- === å½ˆè·³è¦–çª— â‘¡ï¼šå•Ÿç”¨è²éŸ³ï¼ˆç¬¬äºŒå€‹çœ‹åˆ°ï¼‰=== -->
  <div id="unlockOverlay" class="overlay hidden" role="dialog" aria-modal="true" aria-labelledby="unlockTitle">
    <div class="dialog">
      <h3 id="unlockTitle">å•Ÿç”¨è²éŸ³</h3>
      <p class="ios-hint">iPhoneè«‹ç¢ºä¿å´é‚Šã€ŒéœéŸ³éµã€æœ‰é–‹å•ŸéŸ¿éˆ´æ¨¡å¼</p>
      <div class="actions">
        <button id="cancelUnlock">å–æ¶ˆ</button>
        <button id="confirmUnlock" class="primary">ç¢ºå®š</button>
      </div>
    </div>
  </div>

  <div id="lockScreen" aria-hidden="true"></div>
  <footer>Â© Copyright 2025 MYâ€˜s System Version:b1.0.255</footer>

  <!-- === éŸ³æºåº«ï¼ˆä¸å‹•å³å¯ï¼‰=== -->
  <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.min.js"></script>
  <script>
  /* === å¸¸ç”¨åƒæ•¸ï¼ˆæœ€å¸¸æ”¹ï¼‰=== */
  const WEBHOOK = "https://script.google.com/macros/s/AKfycbztRjcIzTEeRBJCLHgt3X-mZANa9OrkutDwgNcixlupqTfR3ZPZjc2110GVIdMjjCMq/exec"; // âœ… å¯èª¿æ•´ï¼šä½ çš„ Apps Script åŸ·è¡Œç¶²å€
  const TIMEOUT_MS = 10000;     // âœ… å¯èª¿æ•´ï¼šPOST é€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰
  const PRECHECK = true;        // âœ… å¯èª¿æ•´ï¼šé€å‡ºå‰æ˜¯å¦å…ˆæ’ /status
  const $ = s => document.querySelector(s); // ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šä¾¿æ·é¸æ“‡å™¨

  /* âœ… å¯èª¿æ•´ï¼šå¸¸è¦‹ Email ç¶²åŸŸï¼ˆæœƒç”¨ä¾†ç”¢ç”Ÿ datalist è£œå…¨ï¼‰ */
  const COMMON_DOMAINS = [
    'gmail.com','yahoo.com.tw','yahoo.com','outlook.com','icloud.com',
    'hotmail.com','msn.com','live.com'
  ];

  /* === ä¸€æ¬¡æ€§ä¿¡ç®±é»‘åå–® === */
  /* âœ… å¯èª¿æ•´ï¼šæƒ³æ”¾å¯¬å¯åˆª/æ¸›ï¼›æƒ³æ›´åš´å¯æ–°å¢ */
  const DISPOSABLE_DOMAINS = new Set([
    'mailinator.com','guerrillamail.com','sharklasers.com','10minutemail.com',
    'tempmail.com','tempmail.dev','temp-mail.org','moakt.com','yopmail.com',
    'throwawaymail.com','trashmail.com','maildrop.cc','dispostable.com','mail-temp.com'
  ]);

  /* === Email æª¢æ ¸ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šé€™æ®µå’Œå¾Œç«¯å°æ‡‰ï¼Œå½±éŸ¿é–å®šéµå¯ç”¨æ€§ */
  function validEmail(v){
    const s=(v||'').trim();
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(s)) return false;
    if(/\.\./.test(s)) return false;
    const [local,domain] = s.split('@');
    if(/^[0-9]+$/.test(local)) return false;
    if(/[._%+-]$/.test(local)) return false;
    const labels = (domain||'').split('.');
    if(labels.some(l=>!l || l.length>63 || /^-/.test(l) || /-$/.test(l))) return false;
    const tld = labels[labels.length-1]||'';
    if(!/^[A-Za-z]{2,24}$/.test(tld)) return false;
    const d = (domain||'').toLowerCase();
    for(const bad of DISPOSABLE_DOMAINS){ if(d===bad || d.endsWith('.'+bad)) return false; }
    return true;
  }

  /* === ç‹€æ…‹åˆ— === */
  /* ğŸ§© é€²éšå¯èª¿ï¼šè¦æ”¹åˆ¤æ–·é—œéµå­—/æ¨£å¼ï¼Œå¯æ”¹é€™è£¡èˆ‡ä¸Šæ–¹ CSS */
  const setStatus = m => {
    const el = $('#status'); el.textContent = m; el.classList.remove('ok','busy','err');
    if(/å·²è¼‰å…¥/.test(m)) el.classList.add('ok');
    else if(/é€å‡ºä¸­/.test(m)) el.classList.add('busy');
    else if(/âŒ|å¤±æ•—|é€¾æ™‚|æ‰¾å°‹ä¸åˆ°|å·²é|æ ¼å¼ä¸æ­£ç¢º|å¿™ç¢Œ/.test(m)) el.classList.add('err');
  };

  /* === å…¨åŸŸè®Šæ•¸ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šéŸ³æº/é–å®š/é¸éŸ³é‚è¼¯ */
  let audioCtx=null, sampler=null, samplerReady=false, unlocked=false, hardLocked=false;
  let currentInstrument='piano';
  let selectedNotes = [];
  let selectedInsts = [];

  /* === éŸ³è‰²è·¯å¾‘ === */
  /* âœ… å¯èª¿æ•´ï¼šå¦‚éŸ³è‰²æª”å­˜æ”¾è·¯å¾‘ä¸åŒï¼Œå¯æ”¹ baseUrl æˆ–æª”åè¡¨ */
  const PIANO_BASE = new URL('./piano/', location.href).href;
  const GUITAR_BASE = new URL('./guitar/', location.href).href;
  const PIANO_URLS = {'A1':'A1.mp3','C2':'C2.mp3','D#2':'Ds2.mp3','F#2':'Fs2.mp3','A2':'A2.mp3','C3':'C3.mp3','D#3':'Ds3.mp3','F#3':'Fs3.mp3','A3':'A3.mp3','C4':'C4.mp3','D#4':'Ds4.mp3','F#4':'Fs4.mp3','A4':'A4.mp3','C5':'C5.mp3'};
  const GUITAR_URLS = {'E2':'E2.wav','A2':'A2.wav','D3':'D3.wav','G3':'G3.wav','B3':'B3.wav','E4':'E4.wav'};

  /* === é‹¼ç´éŸ³éš === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šéµä½è¨ˆç®—ä¾è³´é€™äº›è¨­å®š */
  const WHITE=["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4"];
  const BLACK_AFTER={ 'C':'C#','D':'D#','F':'F#','G':'G#','A':'A#' };
  const MIN_WHITE_PX=64, TOTAL_WHITE=WHITE.length;

  /* === å‰ä»–éŸ³åè¨ˆç®— === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šéŸ³é«˜è½‰æ›ä¾è³´é€™äº›è¨­å®š */
  const TUNING_MIDI = [40,45,50,55,59,64];
  const NOTE_NAMES = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];

  /* === å¿«é€ŸæŸ¥è©¢ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šèˆ‡å¾Œç«¯ /status å°æ‡‰ */
  async function getStatusFast(code, email, signal){
    try{
      const url = WEBHOOK + '?action=status&code=' + encodeURIComponent(code) + '&email=' + encodeURIComponent(email);
      const r = await fetch(url, { method:'GET', cache:'no-store', signal });
      if(!r.ok) return { ok:false };
      const j = await r.json();
      return { ok:true, status: j.status || 'none' };
    }catch(_){ return { ok:false }; }
  }

  /* === å•Ÿç”¨éŸ³è¨Š === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šè¡Œå‹•è£ç½®äº’å‹•é™åˆ¶éœ€è¦ç”¨æˆ¶æ‰‹å‹¢è§£é– */
  async function unlockAudio(){
    try{
      const Ctx=window.webkitAudioContext||window.AudioContext;
      if(!audioCtx) audioCtx=new Ctx({latencyHint:'interactive'});
      if(audioCtx.state!=='running') await audioCtx.resume();
      Tone.setContext(new Tone.Context(audioCtx));
      await Tone.start();
      loadSampler(currentInstrument);
      unlocked=true;
      $('#unlockOverlay').classList.add('hidden');
    }catch(e){ setStatus('å•Ÿç”¨å¤±æ•—ï¼š'+e.message); }
  }

  // === éŸ³è‰²æª”å­˜åœ¨æ€§æ¢æ¸¬ï¼ˆé€²éšåµéŒ¯ï¼‰ ================================
  // âœ… å¯èª¿æ•´ï¼štimeoutMsï¼ˆæ¢æ¸¬é€¾æ™‚æ¯«ç§’ï¼‰
  // å›å‚³ true/falseï¼Œä¸æ‹‹éŒ¯ï¼›åªç”¨ä¾†æé†’æ˜¯å¦ 404 / CORSã€‚
  async function probeAsset(url, timeoutMs=6000){ // âœ… å¯èª¿æ•´
    try{
      const ctl = new AbortController();
      const t = setTimeout(()=>ctl.abort(), timeoutMs);
      // å…ˆ HEADï¼›è‹¥ä¸»æ©Ÿä¸æ”¯æ´ HEAD å†é€€å› GET
      let r = await fetch(url, { method:'HEAD', cache:'no-store', signal:ctl.signal });
      if(!r.ok || Number(r.headers.get('content-length'))===0){
        r = await fetch(url, { method:'GET', cache:'no-store', signal:ctl.signal });
      }
      clearTimeout(t);
      return r.ok;
    }catch(_){ return false; }
  }

  /* === åˆ‡æ›éŸ³è‰² === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šéŸ³æºè¼‰å…¥èˆ‡ç‹€æ…‹è¯å‹•ï¼ˆåŠ å…¥é€¾æ™‚ä¿åº•ï¼‹æª”æ¡ˆæ¢æ¸¬ï¼‰ */
  function loadSampler(inst='piano'){
    sampler?.dispose?.(); sampler=null; samplerReady=false;

    // âœ… å¯èª¿æ•´ï¼šæš±ç¨±åœ–ç¤ºèˆ‡åº«ä¾†æº
    let urls=PIANO_URLS, base=PIANO_BASE, label='ğŸ¹ ';
    if(inst==='guitar'){ urls=GUITAR_URLS; base=GUITAR_BASE; label='ğŸ¸ '; }

    setStatus(label+'è¼‰å…¥ä¸­â€¦');

    // â‘  æ¢æ¸¬å…¶ä¸­ä¸€å€‹æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼ˆé¿å…æ°¸é å¡ä½ï¼‰
    const firstKey = Object.keys(urls)[0];
    const testUrl  = base + urls[firstKey];
    probeAsset(testUrl, 5000 /* âœ… å¯èª¿æ•´ï¼šæ¢æ¸¬é€¾æ™‚ */).then(ok=>{
      if(!ok){
        setStatus(
          'âš ï¸ ç„¡æ³•è®€å–éŸ³è‰²æª”\n'//è«‹æª¢æŸ¥è·¯å¾‘/å¤§å°å¯«/CORSï¼š\n' + testUrl ï¼ˆç›®éŒ„éœ€èˆ‡æ­¤é åŒå±¤ï¼›æª”åè¡¨è¦è·Ÿå¯¦æª”ä¸€è‡´ï¼šå¦‚ D#4â†’Ds4.mp3ï¼‰
        );
      }
    });

    // â‘¡ å»ºç«‹ Samplerï¼ˆæ­£å¸¸æœƒè§¸ç™¼ onloadï¼‰
    try{
      sampler=new Tone.Sampler({
        urls,
        release:1,                 // âœ… å¯èª¿æ•´ï¼šé‡‹æ”¾å°¾éŸ³
        baseUrl:base,
        onload:()=>{               // è¼‰å…¥æˆåŠŸ
          samplerReady=true;
          setStatus(label+'å·²è¼‰å…¥ âœ…');
        }
      }).toDestination();
    }catch(e){
      setStatus('âŒ éŸ³è‰²åˆå§‹åŒ–å¤±æ•—ï¼š'+e.message);
      return;
    }

    // â‘¢ çœ‹é–€ç‹—ï¼šè¶…é N ç§’ä»æœª readyï¼Œé¡¯ç¤ºå¯æ“ä½œçš„æ’éŒ¯æç¤º
    const WATCH_MS=9000;           // âœ… å¯èª¿æ•´ï¼šè¼‰å…¥é€¾æ™‚åˆ¤å®šæ¯«ç§’
    setTimeout(()=>{
      if(!samplerReady){
        setStatus(
          'â±ï¸ è¼‰å…¥è¶…æ™‚\n' // å¯èƒ½åŸå› æª”æ¡ˆè·¯å¾‘ä¸å° / å¤§å°å¯«ä¸ç¬¦ï¼ˆä¸»æ©Ÿå€åˆ†å¤§å°å¯« ç›®éŒ„ä½ç½®ä¸åŒï¼ˆç›®å‰ baseUrlï¼š'+ base +'ï¼‰ä¸åŒç¶²åŸŸé€ æˆ CORS æ“‹ä½ æª”åè¡¨èˆ‡å¯¦éš›æª”åä¸ä¸€è‡´ï¼ˆä¾‹ï¼šD#4 â†’ Ds4.mp3ï¼‰
        );
      }
    }, WATCH_MS);
  }

  /* === ä¸‰éŸ³é¡¯ç¤º === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  function refreshNotesDisplay(){ const parts=[selectedNotes[0]||'â€”', selectedNotes[1]||'â€”', selectedNotes[2]||'â€”']; $('#lastNote').value = parts.join(' , '); }

  /* === æ’­éŸ³ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  function trigger(note){
    if(hardLocked) return;
    if(!samplerReady){ setStatus('éŸ³è‰²è¼‰å…¥ä¸­â€¦'); return; }
    sampler.triggerAttackRelease(note,'8n');
    if(selectedNotes.length<3){ selectedNotes.push(note); selectedInsts.push(currentInstrument); }
    else { selectedNotes[2]=note; selectedInsts[2]=currentInstrument; }
    refreshNotesDisplay(); validateLockBtn();
  }

  /* === é–å®šéµå¯ç”¨æ€§ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šé€™è£¡èˆ‡ validEmail äº’é– */
  function validateLockBtn(){
    const nameOk = ($('#displayName').value||'').trim().length>0;
    const codeOk = ($('#code').value||'').trim().length>0;
    const emailOk = validEmail($('#email').value);
    const notesOk = selectedNotes.length===3;
    $('#lockBtn').disabled = !(nameOk && codeOk && emailOk && notesOk);
  }

  /* === äº‹ä»¶ç¶å®šï¼ˆè¡¨å–®ï¼‰ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  $('#instrument').addEventListener('change', ()=>{
    if(hardLocked) return;
    currentInstrument=$('#instrument').value;
    loadSampler(currentInstrument);
    if(currentInstrument==='guitar') renderGuitar(); else renderPiano();
    validateLockBtn();
  });
  $('#displayName').addEventListener('input', validateLockBtn);
  $('#code').addEventListener('input', validateLockBtn);

  /* âœ… Email è¼¸å…¥ï¼šå« @ æ™‚å‹•æ…‹å»ºç«‹ã€Œå®Œæ•´ emailã€å€™é¸æ¸…å–®ï¼›å¦å‰‡ç§»é™¤ list */
  /* âœ… å¯èª¿æ•´ï¼šå¦‚è¦å›ºå®šé¡¯ç¤ºæ‰€æœ‰ç¶²åŸŸï¼Œå¯æŠŠ startsWith çš„æ¿¾æ‰ */
  const emailInput = $('#email');
  const emailList  = $('#emailDomains');
  $('#email').addEventListener('input', ()=>{
    const v = emailInput.value;
    if(v.includes('@')){
      const [local,frag=''] = v.split('@');
      const lowerFrag = frag.toLowerCase();
      const options = (local ? COMMON_DOMAINS : [])
        .filter(d => d.startsWith(lowerFrag))
        .map(d => `<option value="${local}@${d}"></option>`)
        .join('');
      emailList.innerHTML = options || (local ? COMMON_DOMAINS.map(d=>`<option value="${local}@${d}"></option>`).join('') : '');
      emailInput.setAttribute('list','emailDomains');
    }else{
      emailInput.removeAttribute('list');
      emailList.innerHTML = '';
    }
    validateLockBtn();
  });

  /* === é‡è¨­ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  $('#resetBtn').addEventListener('click', ()=>{
    if(hardLocked) return;
    if(selectedNotes.length>0){ selectedNotes.pop(); selectedInsts.pop(); refreshNotesDisplay(); validateLockBtn(); }
  });

  /* === èªªæ˜æŒ‰éˆ• â†’ å°æµ®å±¤ === */
  /* ğŸ§© é€²éšå¯èª¿ï¼šè‹¥æƒ³å›ºå®šé¡¯ç¤º/æ”¹ä½ç½®ï¼Œå¯æ”¹ positionArrow èˆ‡ CSS è®Šæ•¸ */
  const hintBtn = $('#hintBtn');
  const hintPop = $('#hintPopover');

  function positionArrow(){
    const popRect = hintPop.getBoundingClientRect();
    const btnRect = hintBtn.getBoundingClientRect();
    const x = (btnRect.left + btnRect.width/2) - popRect.left;
    const clamped = Math.max(16, Math.min(popRect.width-16, x));
    hintPop.style.setProperty('--arrow-x', clamped + 'px');
  }
  function closeHint(){ hintPop.classList.remove('show'); hintBtn.setAttribute('aria-expanded','false'); }
  hintBtn.addEventListener('click', (e)=>{
    const showing = hintPop.classList.toggle('show');
    hintBtn.setAttribute('aria-expanded', showing ? 'true' : 'false');
    if(showing){ positionArrow(); }
    e.stopPropagation();
  });
  document.addEventListener('click', (e)=>{
    if(!hintPop.classList.contains('show')) return;
    const within = hintPop.contains(e.target) || hintBtn.contains(e.target);
    if(!within) closeHint();
  });
  window.addEventListener('resize', ()=>{ if(hintPop.classList.contains('show')) positionArrow(); });
  window.addEventListener('orientationchange', ()=>{ setTimeout(()=>{ if(hintPop.classList.contains('show')) positionArrow(); }, 250); });
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeHint(); });

  /* === å…©å€‹å½ˆè·³è¦–çª—ï¼ˆäº‹ä»¶å§”æ´¾ï¼‹touchend æ”¯æ´ï¼ŒiOS å¯é»ï¼‰=== */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  function hide(el){ el.classList.add('hidden'); }
  function show(el){ el.classList.remove('hidden'); }
  ['click','touchend'].forEach(evt=>{
    document.addEventListener(evt,(e)=>{
      const t = e.target;
      if(t.id==='guideOk'){
        hide(document.getElementById('guideOverlay'));
        show(document.getElementById('unlockOverlay'));
        e.preventDefault();
      }else if(t.id==='cancelUnlock'){
        hide(document.getElementById('unlockOverlay'));
        e.preventDefault();
      }else if(t.id==='confirmUnlock'){
        unlockAudio(); hide(document.getElementById('unlockOverlay'));
        e.preventDefault();
      }
    }, {passive:true});
  });

  /* === é€å‡ºï¼ˆé–å®šï¼‰ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ï¼šèˆ‡å¾Œç«¯éŒ¯èª¤ç¢¼å°æ‡‰ï¼›è¨Šæ¯å…§å®¹å¯å¾®èª¿ */
  $('#lockBtn').addEventListener('click', async ()=>{
    if(hardLocked) return;
    const name=($('#displayName').value||'').trim();
    const code=($('#code').value||'').trim();
    const email=($('#email').value||'').trim();
    if(!name||!code||!validEmail(email)||selectedNotes.length!==3){ alert('è«‹å¡«å§“åã€ä»£è™Ÿã€Email ä¸¦å½ˆæ»¿ 3 å€‹éŸ³å†é–å®š'); return; }

    if(PRECHECK){
      try{
        const pre = await getStatusFast(code, email);
        if(pre.ok){
          if(pre.status==='used'){
            // âœ… ä¸ returnï¼Œè®“å¾Œç«¯ç²¾æº–åˆ¤æ–·ï¼ˆduplicate+deadline_passed / duplicate+code_not_foundï¼‰
            setStatus('ğŸ“ å·²å¡«å¯«éï¼Œæ­£åœ¨ç¢ºèªæ˜¯å¦å·²éæœŸæˆ–ä»£è™Ÿå•é¡Œâ€¦');
          }else if(pre.status==='inflight'){
            setStatus('ğŸ•’ è³‡æ–™è™•ç†ä¸­ï¼Œè«‹å‹¿é‡è¤‡é€å‡ºâ›”');
            return;
          }
        }
      }catch(_e){}
    }

    setStatus('â³ é€å‡ºä¸­â€¦');
    const instrumentField = selectedInsts.length ? selectedInsts.join(',') : currentInstrument;
    const payload={ userId:code, displayName:name, instrument:instrumentField, note:selectedNotes.join(','), velocity:1, sessionId:'demo', email };

    const controller=new AbortController();
    const timer=setTimeout(()=>controller.abort(),TIMEOUT_MS);
    try{
      const r=await fetch(WEBHOOK,{ method:'POST', headers:{'Content-Type':'text/plain'}, body:JSON.stringify(payload), signal:controller.signal });
      clearTimeout(timer);
      if(r.headers.get('content-type')?.includes('application/json')){
        const data = await r.json();
        if(data.ok){ setStatus('âœ… å·²é€å‡ºæˆåŠŸï¼Œå¯é€€å®‰å›‰'); enterHardLock(); }
        else{
          let msg='âŒ é€å‡ºå¤±æ•—'; const err=String(data.error||'');
          if(err.includes('duplicate+deadline_passed')) msg='ğŸ“… å·²å¡«å¯«éå›‰ï¼Œä¸”å·²éæˆªæ­¢æ—¥ğŸ’”';
          else if(err.includes('duplicate+code_not_found')) msg='ğŸ” å·²å¡«å¯«éå›‰ï¼Œä¸”ä»£è™Ÿä¸å­˜åœ¨ğŸ‘€';
          else if(err==='duplicate') msg='ğŸ“ å·²å¡«å¯«éå›‰ï¼Œæƒ³è¦æ›´æ›éŸ³éšè«‹æ´½ã„Ÿå’ªğŸ™';
          else if(err==='email_required') msg='âš ï¸ Emailç¼ºå°‘æˆ–æ ¼å¼ä¸æ­£ç¢ºï¼Œè·ªæ±‚çœŸæ­£çš„mailğŸ™‡â€â™‚ï¸';
          else if(err==='email_domain_invalid') msg='ğŸŒ Emailç¶²åŸŸç„¡æ³•æ”¶ä¿¡ï¼Œè«‹ç¢ºèªæ‹¼å­—æˆ–æ›´æ›ğŸ“®';
          else if(err==='deadline_passed') msg='ğŸ“£ å·²éå¡«å¯«æˆªæ­¢æ—¥ï¼Œä½†é‚„å¯åœ¨é€™ç©è€å”·ğŸ‘£';
          else if(err==='code_not_found') msg='ğŸ” æ‰¾å°‹ä¸åˆ°ä»£è™Ÿï¼Œè«‹æ´½æ–°äººğŸ¤µğŸ»â€â™‚ï¸ğŸ‘°ğŸ»â€â™€ï¸';
          else if(err==='busy') msg='âš ï¸ ç³»çµ±å¿™ç¢Œï¼Œç¨å¾Œå†è©¦ğŸŒ€';
          setStatus(msg);
        }
      }else{
        if(r.ok){ setStatus('âœ… å·²é€å‡ºæˆåŠŸï¼Œå¯é€€å®‰å›‰'); enterHardLock(); }
        else{ setStatus('âŒ é€å‡ºå¤±æ•—'); }
      }
    }catch(e){
      try{
        const post = await getStatusFast(code, email);
        if(post.ok){
          if(post.status==='used'){ setStatus('âœ… å·²é€å‡ºæˆåŠŸï¼Œå¯é€€å®‰å”·'); enterHardLock(); return; }
          if(post.status==='inflight'){ setStatus('â³ å¯èƒ½å·²é€é”ï¼Œä¼ºæœå™¨è™•ç†ä¸­ï¼Œè«‹å‹¿é‡è¤‡é€å‡ºâ›”'); return; }
        }
      }catch(_e){}
      setStatus('âŒ é€å‡ºé€¾æ™‚æˆ–å¤±æ•—');
    }
  });

  /* === æˆåŠŸå¾Œå‡çµç•«é¢ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  function enterHardLock(){
    hardLocked=true;
    $('#displayName').disabled=true; $('#code').disabled=true; $('#email').disabled=true; $('#instrument').disabled=true;
    $('#resetBtn').disabled=true; $('#lockBtn').disabled=true;
    $('#lockScreen').style.display='block';
  }

  /* === é‹¼ç´ç¹ªè£½ï¼ˆç§»é™¤éµå¸½æ¨™ç±¤ï¼‰=== */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  function renderPiano(){
    const kb=$('#keyboard'); kb.innerHTML=''; kb.className='';
    sizePiano();
    const keyW=100/TOTAL_WHITE;
    WHITE.forEach((note,i)=>{
      const w=document.createElement('div'); w.className='white'; w.dataset.note=note;
      w.style.left=(i*keyW)+'%'; w.style.width=keyW+'%';
      w.addEventListener('pointerdown', ()=>{ if(hardLocked) return; if(!unlocked){ $('#unlockOverlay').classList.remove('hidden'); return; } trigger(note); w.classList.add('active'); });
      w.addEventListener('pointerup', ()=>w.classList.remove('active'));
      kb.appendChild(w);
    });
    WHITE.forEach((note,i)=>{
      const l=note[0], sharp = BLACK_AFTER[l]? (BLACK_AFTER[l]+note.slice(1)) : null;
      if(!sharp || (l==='A' && i===TOTAL_WHITE-1)) return;
      const b=document.createElement('div'); b.className='black'; b.dataset.note=sharp;
      const blackWidthPct = keyW*0.62; b.style.width = blackWidthPct+'%'; b.style.left=((i+1)*keyW)+'%';
      b.addEventListener('pointerdown', ()=>{ if(hardLocked) return; if(!unlocked){ $('#unlockOverlay').classList.remove('hidden'); return; } trigger(sharp); b.classList.add('active'); });
      b.addEventListener('pointerup', ()=>b.classList.remove('active'));
      kb.appendChild(b);
    });
  }

  /* === é‹¼ç´å°ºå¯¸ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  function sizePiano(){
    const wrap=document.querySelector('.kb-wrap'); const kb=document.querySelector('#keyboard');
    const wrapW=wrap.clientWidth; const sep=parseInt(getComputedStyle(kb).getPropertyValue('--sep')||'2',10);
    const minW=WHITE.length*(MIN_WHITE_PX+sep);
    kb.style.width=(wrapW>=minW?wrapW-1:minW)+'px'; kb.style.height='var(--kb-h)';
  }

  /* === å‰ä»–ç¹ªè£½ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  function renderGuitar(){
    const kb=$('#keyboard'); kb.innerHTML=''; kb.className='fretboard'; kb.style.height='var(--kb-h)';
    const head=document.createElement('div'); head.className='head'; kb.appendChild(head);
    const nut =document.createElement('div');  nut.className='nut';  kb.appendChild(nut);
    const bridge=document.createElement('div'); bridge.className='bridge'; kb.appendChild(bridge);
    for(let s=0;s<6;s++){
      const y=(s+1)*(100/7);
      const str=document.createElement('div'); str.className='string'; str.dataset.s=String(s); str.style.top = `${y}%`; kb.appendChild(str);
      const hline=document.createElement('div'); hline.className='head-line'; hline.dataset.s=String(s); hline.style.top = `${y}%`; kb.appendChild(hline);
    }
    for(let f=1; f<=13; f++){
      const col=document.createElement('div'); col.className='fret-col';
      for(let s=0; s<6; s++){
        const y=(s+1)*(100/7);
        const hit=document.createElement('div'); hit.className='hit-row'; hit.style.top = `${y}%`; col.appendChild(hit);
      }
      if([4,6,8,10].includes(f)){
        const dot=document.createElement('div'); dot.style.cssText='position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:16px;height:16px;border-radius:50%;background:#dbc6a4;opacity:.9;box-shadow:0 1px 0 rgba(0,0,0,.35);pointer-events:none;'; col.appendChild(dot);
      }else if(f===13){
        const dot1=document.createElement('div'); dot1.style.cssText='position:absolute;left:50%;top:38%;transform:translate(-50%,-50%);width:14px;height:14px;border-radius:50%;background:#dbc6a4;opacity:.9;box-shadow:0 1px 0 rgba(0,0,0,.35);pointer-events:none;';
        const dot2=document.createElement('div'); dot2.style.cssText='position:absolute;left:50%;top:62%;transform:translate(-50%,-50%);width:14px;height:14px;border-radius:50%;background:#dbc6a4;opacity:.9;box-shadow:0 1px 0 rgba(0,0,0,.35);pointer-events:none;';
        col.appendChild(dot1); col.appendChild(dot2);
      }
      col.addEventListener('pointerdown',(ev)=>{
        if(hardLocked) return;
        if(!unlocked){ $('#unlockOverlay').classList.remove('hidden'); return; }
        const rect = col.getBoundingClientRect();
        const y = ev.clientY - rect.top;
        const slot = rect.height/7;
        let idx = Math.round(y/slot - 1);
        idx = Math.max(0, Math.min(5, idx));
        if(f<=12){
          const midi = TUNING_MIDI[5-idx] + f;
          const note = NOTE_NAMES[midi % 12] + (Math.floor(midi/12) - 1);
          trigger(note);
        }
        const target = kb.querySelector(`.string[data-s="${idx}"]`);
        if(target){
          target.classList.remove('vibrate'); void target.offsetWidth; target.classList.add('vibrate');
          setTimeout(()=>target.classList.remove('vibrate'), 380);
        }
      });
      kb.appendChild(col);
    }
  }

  /* === è¦–çª—å°ºå¯¸ === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  window.addEventListener('resize', ()=>{ if(currentInstrument==='piano') sizePiano(); });
  window.addEventListener('orientationchange', ()=>{ if(currentInstrument==='piano') sizePiano(); });

  /* === åˆå§‹åŒ– === */
  /* ğŸ”’ è«‹å‹¿æ›´å‹•æµç¨‹ */
  window.addEventListener('DOMContentLoaded', ()=>{
    renderPiano(); setStatus('ç­‰å¾…å•Ÿç”¨è²éŸ³â€¦'); validateLockBtn();
    $('#guideOverlay').classList.remove('hidden');
  });
  </script>
</body>
</html>


