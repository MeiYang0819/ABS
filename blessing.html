<!doctype html>
<html lang="zh-Hant">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é€ä¸Šç¥ç¦ï¼ˆæ¸¬è©¦ç‰ˆï¼‰</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Patrick+Hand:wght@400&family=Sacramento:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  /* â€”â€” ä¸»é¡Œ â€”â€” */
  --brand-bg:#c9daf8;
  --title:#A68A7C;
  --ink:#0f172a; --accent:#A68A7C; --rim:#E4E4E4; --soft:#F5F1EC;

  /* â€”â€” å¤–å±¤è—è‰²é¢æ¿ï¼ˆå¯ç–Šåœ–ï¼‰â€”â€” */
  --panel-grad-from:#b7d2f6;
  --panel-grad-to:#cfe1fb;
  --panel-bg-image:none;

  /* â€”â€” å…§é ï¼ˆé»ƒè‰²å¡ç‰‡ï¼‰èˆ‡å©šç¦®åœ–å±¤ â€”â€” */
  --paper-grad-from:rgba(255,242,204,.98);
  --paper-grad-to:rgba(255,242,204,.92);
  --card-image:url('./assets/wedding.png');   /* ä½ çš„å©šç¦®åœ–ï¼šç–Šåœ¨é»ƒåº•ä¹‹ä¸Š */
  --card-image-opacity:.36;                   /* ç–Šå±¤é€æ˜åº¦ï¼ˆå¯èª¿ï¼‰ */
  --card-image-size: 520px;                   /* ç–Šå±¤å¤§å°ï¼ˆå¯èª¿ï¼špx / contain / coverï¼‰ */
  --card-image-filter: contrast(1.06) saturate(1.08); /* è‰²å½©æ ¡æ­£ï¼ˆå¯èª¿ï¼‰ */

  --panel-maxw:1060px; --card-maxw:900px;
  --radius-xl:16px; --radius-md:12px;
  --shadow-1:0 10px 26px rgba(0,0,0,.10);
  --shadow-2:0 2px 0 rgba(0,0,0,.15), 0 2px 8px rgba(0,0,0,.06);

  --content-pad:22px; --editor-zoom:1rem;
  --toolbar-gap:8px; --status-fz:14px; --h2-size:2.8rem;
  --stroke:rgba(0,0,0,.18); --glow:rgba(255,255,255,.65);

  --footer-gap:48px;
  --btn-w:220px; --btn-h:50px;

  /* â€”â€” å…¨é èƒŒæ™¯åŠ æ·±ç¨‹åº¦ â€”â€” */
  --bg-photo-opacity:.42;                     /* åŸç”Ÿåœ–é€æ˜åº¦ï¼ˆè¶Šå¤§è¶Šæ·±ï¼‰ */
  --bg-tint: rgba(0,0,0,.10);                 /* é¡å¤–è‰²ç½©ï¼ˆå†åŠ æ·±ä¸€é»é»ï¼‰ */
}

/* åŸºæœ¬ï¼†å›ºå®šç‰ˆé¢ */
*{ box-sizing:border-box; }
html,body{
  height:100%; margin:0; overflow:hidden;
  color:var(--ink); background:var(--brand-bg);
  font-family:"Patrick Hand","Noto Sans TC",system-ui,-apple-system,sans-serif;
  -webkit-text-stroke:.35px var(--stroke); text-shadow:0 1px 0 var(--glow);
}

/* æ•´é èƒŒæ™¯èˆ‡åŠ æ·±è‰²ç½© */
.bg-photo{ position:fixed; inset:0; z-index:0; width:100%; height:100%; object-fit:cover; opacity:var(--bg-photo-opacity); pointer-events:none; }
.bg-tint{  position:fixed; inset:0; z-index:0; background:var(--bg-tint); pointer-events:none; }

/* å¤–å±¤è—é¢æ¿ */
.panel{
  position:relative; z-index:1; max-width:var(--panel-maxw);
  height:calc(100vh - (70px + var(--footer-gap)));
  margin:26px auto;
  background:
    linear-gradient(135deg, var(--panel-grad-from), var(--panel-grad-to)),
    var(--panel-bg-image);
  background-size:auto, cover; background-position:left top, center;
  border:1px solid var(--rim); border-radius:var(--radius-xl);
  box-shadow:var(--shadow-1);
  display:grid; grid-template-rows:auto auto 1fr auto; overflow:hidden;
}

/* æ¨™é¡Œåˆ— */
.titlebar{ padding:10px 16px 6px; }
h2{
  margin:0 0 6px; text-align:center; font-family:"Sacramento",cursive;
  font-weight:700; font-size:var(--h2-size); letter-spacing:1px; color:var(--title);
  -webkit-text-stroke:.6px rgba(0,0,0,.12); text-shadow:0 3px 4px rgba(255,255,255,.75);
}

/* å·¥å…·åˆ—ï¼‹ç‹€æ…‹åˆ—ï¼šèˆ‡å…§æ–‡é½Šå¯¬ */
.bar{ padding:6px 22px 8px; }
.bar-inner{ max-width:var(--card-maxw); margin:0 auto; display:flex; align-items:center; gap:12px; }
.toolbar{ display:flex; gap:var(--toolbar-gap); filter:drop-shadow(0 2px 0 rgba(0,0,0,.08)); }
.tool-btn,.tool-select{
  min-width:64px; height:36px; padding:0 12px; background:#fff; border:1px solid var(--rim); border-radius:var(--radius-md);
  font-weight:700; display:flex; align-items:center; justify-content:center; gap:6px; box-shadow:var(--shadow-2);
}
.tool-select{ min-width:auto; padding:0 10px; }
.tool-btn:active{ transform:translateY(1px) scale(.99); }

#status{
  flex:1 1 auto; min-width:320px;
  background:var(--soft); border:1px solid #E4E4E4; border-radius:12px; padding:10px;
  font-size:var(--status-fz); text-align:center; color:var(--accent)!important; font-weight:700;
  -webkit-text-stroke:.35px rgba(0,0,0,.10); text-shadow:0 1px 0 rgba(255,255,255,.85),0 3px 6px rgba(0,0,0,.04);
}

/* ä¸­æ®µï¼šå·¦å´ç¯©é¸ + å³å´ç·¨è¼¯/ç‰† */
.main{ display:grid; grid-template-columns:220px 1fr; gap:14px; padding:0 16px 0 16px; overflow:hidden; }
.sidebar{ padding:8px; }
.side-card{
  background:#fff; border:1px solid var(--rim); border-radius:12px; padding:10px; box-shadow:var(--shadow-2);
}
.side-title{ margin:4px 0 10px; font-weight:700; text-align:center; -webkit-text-stroke:0; text-shadow:none; color:#6b5e52; }
.side-btns{ display:grid; gap:8px; }
.side-btn{
  height:36px; border:1px solid var(--rim); border-radius:10px; background:#fff; cursor:pointer; font-weight:700; box-shadow:var(--shadow-2);
}
.side-btn.active{ outline:2px solid #bfa5a0; }

/* ç·¨è¼¯å¡ç‰‡ï¼ˆé»ƒè‰²ï¼‰ */
.editor-wrap{
  position:relative; height:100%; display:grid; grid-template-rows:auto 1fr auto; gap:10px; overflow:hidden;
}
.card{
  position:relative; width:100%; max-width:var(--card-maxw); margin:0 auto;
  background: linear-gradient(180deg, var(--paper-grad-from), var(--paper-grad-to)); /* ä¸‹å±¤ï¼šé»ƒåº•æ¼¸å±¤ */
  border:1px solid rgba(0,0,0,.05); border-radius:var(--radius-xl);
  box-shadow:0 10px 26px rgba(0,0,0,.08);
  padding:var(--content-pad);
  /* é ç•™ç©ºé–“ï¼šä¸Šæ–¹æ–°äººå¾½ç«  42pxã€ä¸‹æ–¹ç°½åå¾½ç«  50px */
  padding-top:calc(var(--content-pad) + 44px);
  padding-bottom:calc(var(--content-pad) + 56px);
  overflow:hidden;
}

/* å©šç¦®åœ–ï¼šç–Šåœ¨å¡ç‰‡å…§å®¹æœ€ä¸Šå±¤ï¼Œä½†ä¸æ“‹äº’å‹•ï¼ˆpointer-events:noneï¼‰ */
.card::before{
  content:""; position:absolute; inset:0; z-index:1; pointer-events:none;
  background-image: var(--card-image);
  background-repeat:no-repeat;
  background-position: right 20px bottom 16px; /* è§’è½æ’ç‰ˆå¯èª¿ */
  background-size: var(--card-image-size);
  opacity: var(--card-image-opacity);
  filter: var(--card-image-filter);
}

/* å…§å®¹å±¤ç´šè¨­å®šï¼šç·¨è¼¯å™¨åœ¨ z=2ï¼Œå¾½ç«  z=3ï¼Œç–Šåœ– z=1 */
.editor{ position:relative; z-index:2; }

/* æ–°äººï¼†ç°½åå¾½ç« ï¼šæ”¹ç‚ºå¡ç‰‡ã€Œå…§å´ã€å›ºå®šï¼Œä¸å†æº¢å‡º */
.badge{
  position:absolute; z-index:3; color:var(--ink);
  padding:10px 14px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.06); font-weight:700;
  display:flex; align-items:center; gap:8px; font-size:1.05rem;
  background:linear-gradient(180deg, var(--paper-grad-from), var(--paper-grad-to));
}
.badge-top-left{ left:10px; top:10px; border:none; }
.badge-bottom-right{ right:10px; bottom:10px; border:1px solid rgba(0,0,0,.08); cursor:pointer; }
.badge-bottom-right .hint{ opacity:.18; }
.badge-bottom-right img{ display:none; width:72px; height:40px; object-fit:contain; background:#fff; border-radius:6px; border:1px dashed rgba(0,0,0,.12); }
.badge-bottom-right.has-img img{ display:block; }

/* ç·¨è¼¯å™¨ */
.editor{
  min-height:260px; max-height:42vh; overflow:auto;
  line-height:1.8; outline:none; background:transparent; border-radius:var(--radius-md); padding:10px 12px;
  font-size:var(--editor-zoom);
}
.editor[data-empty]{ opacity:.22; }

/* é€å‡ºéµå€ */
.actions{ display:flex; justify-content:center; margin:8px 0 4px; }
.primary{ min-width:var(--btn-w); height:var(--btn-h); padding:0 20px; background:#fff; border:1px solid var(--rim); border-radius:var(--radius-md); font-weight:700; cursor:pointer; box-shadow:var(--shadow-2); }
.primary:active{ transform:translateY(1px) scale(.99); }

/* ç¥ç¦ç‰† */
.wall{
  height:100%; overflow:auto; padding:8px 6px 10px; border-top:1px dashed rgba(0,0,0,.06);
}
.wall-grid{
  display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr));
  gap:12px; align-content:start;
}
.wall-card{
  position:relative; height:160px; border:1px solid var(--rim); border-radius:12px; background:#fff; box-shadow:var(--shadow-2);
  padding:10px 12px 12px; display:flex; flex-direction:column; overflow:hidden; cursor:pointer;
}
.wall-card .meta{ font-size:13px; color:#6b5e52; -webkit-text-stroke:0; text-shadow:none; display:flex; justify-content:space-between; gap:6px; }
.wall-card .txt{ margin-top:6px; font-size:14px; line-height:1.5; -webkit-text-stroke:0; text-shadow:none; color:#444; overflow:hidden; display:-webkit-box; -webkit-line-clamp:5; -webkit-box-orient:vertical; }
.wall-card .sig{
  position:absolute; right:8px; bottom:8px; width:72px; height:40px; object-fit:contain; background:#fff; border-radius:6px; border:1px dashed rgba(0,0,0,.12);
}

/* è©³æƒ… Modalï¼ˆå”¯è®€ï¼‰ */
.overlay{ position:fixed; inset:0; z-index:9999; display:none; align-items:center; justify-content:center; background:rgba(17,24,39,.35); backdrop-filter:blur(3px); }
.overlay.show{ display:flex; }
.dialog{ width:min(92vw,720px); max-height:86vh; overflow:auto; background:var(--soft); border:1px solid var(--rim); border-radius:14px; padding:16px; box-shadow:0 18px 44px rgba(0,0,0,.18); }
.dialog h3{ margin:0 0 10px; font-size:18px; color:#6b5e52; text-align:center; -webkit-text-stroke:0; text-shadow:none; }
.detail{
  background:#fff; border:1px solid var(--rim); border-radius:12px; padding:14px; -webkit-text-stroke:0; text-shadow:none; color:#222;
}
.detail .sig{ margin-top:10px; width:160px; height:88px; object-fit:contain; background:#fff; border:1px dashed rgba(0,0,0,.12); border-radius:8px; }
.dlg-actions{ display:flex; gap:10px; justify-content:center; margin-top:12px; }
.dlg-actions button{ width:120px; height:38px; border-radius:10px; border:1px solid var(--rim); background:#fff; cursor:pointer; font-weight:700; }

footer{
  position:fixed; left:0; right:0; bottom:var(--footer-gap);
  text-align:center; color:#6b5e52; font-size:12px; opacity:.9; pointer-events:none; z-index:5;
}

/* æ”¾å¤§ç¸®å° class */
.fs-up-1{font-size:1.15em;} .fs-up-2{font-size:1.30em;} .fs-up-3{font-size:1.50em;}
.fs-down-1{font-size:.92em;} .fs-down-2{font-size:.84em;} .fs-down-3{font-size:.76em;}
</style>

<body>
  <!-- å…¨é èƒŒæ™¯èˆ‡åŠ æ·± -->
  <img class="bg-photo" src="./assets/wishing.png" alt="">
  <div class="bg-tint"></div>

  <div class="panel">
    <div class="titlebar"><h2>é€ä¸Šç¥ç¦</h2></div>

    <div class="bar">
      <div class="bar-inner">
        <div class="toolbar" role="toolbar" aria-label="æ–‡å­—å·¥å…·">
          <button class="tool-btn" id="btnBold"      type="button">ç²—é«”</button>
          <button class="tool-btn" id="btnItalic"    type="button">æ–œé«”</button>
          <button class="tool-btn" id="btnUnderline" type="button">åº•ç·š</button>
          <select id="colorPick" class="tool-select" title="å­—é«”é¡è‰²">
            <option value="" selected>é¡è‰²</option>
            <option value="#0f172a">å¢¨è‰²</option>
            <option value="#a21caf">ç´«</option>
            <option value="#dc2626">ç´…</option>
            <option value="#2563eb">è—</option>
            <option value="#059669">ç¶ </option>
            <option value="#d97706">æ©˜</option>
            <option value="#6b7280">ç°</option>
          </select>
          <button class="tool-btn" id="btnBigger"    type="button">æ”¾å¤§</button>
          <button class="tool-btn" id="btnSmaller"   type="button">ç¸®å°</button>
        </div>
        <p id="status">å·²å°±ç·’ï¼ˆæ¸¬è©¦æ¨¡å¼ï¼‰</p>
      </div>
    </div>

    <div class="main">
      <!-- å·¦å´ç¯©é¸ï¼ˆä½ ç›®å‰ä½¿ç”¨çš„ Keep é¢¨æ”¾é€™å€ï¼‰ -->
      <aside class="sidebar">
        <div class="side-card">
          <p class="side-title">ç¯©é¸</p>
          <div class="side-btns">
            <button class="side-btn active" data-side="ALL">å…¨éƒ¨</button>
            <button class="side-btn" data-side="GROOM">æ–°éƒ</button>
            <button class="side-btn" data-side="BRIDE">æ–°å¨˜</button>
          </div>
        </div>

        <div class="side-card" style="margin-top:10px">
          <p class="side-title">èº«åˆ†ï¼ˆæ¸¬è©¦ç”¨ï¼‰</p>
          <div class="side-btns">
            <button class="side-btn" id="mockMale">æˆ‘æ˜¯æ–°éƒè¦ªå‹</button>
            <button class="side-btn" id="mockFemale">æˆ‘æ˜¯æ–°å¨˜è¦ªå‹</button>
          </div>
        </div>
      </aside>

      <!-- å³å´ï¼šç·¨è¼¯ï¼‹ç‰† -->
      <section class="editor-wrap">
        <!-- é»ƒå¡ -->
        <div class="card" id="card">
          <div class="badge badge-top-left" id="chipBride"><span id="brideLabel">æ–°äººï¼šâ€”</span></div>
          <div class="badge badge-bottom-right" id="chipSign">
            <span class="hint">é»æˆ‘ç°½å</span>
            <img id="signThumb" alt="signature preview" />
          </div>

          <div id="editor" class="editor" contenteditable="true" aria-label="ç¥ç¦å…§å®¹">
            åœ¨æ­¤å¯«ä¸‹ä½ å°æ–°äººçš„ç¥ç¦â€¦ï¼ˆå¯é¸å­—å¾ŒæŒ‰ä¸Šæ–¹çš„ç²—é«”ï¼æ–œé«”ï¼åº•ç·šï¼é¡è‰²ï¼æ”¾å¤§ï¼ç¸®å°ï¼‰ğŸ’
          </div>
        </div>

        <div class="actions">
          <button id="btnSubmit" class="primary" type="button">é€å‡ºç¥ç¦</button>
        </div>

        <!-- ç¥ç¦ç‰† -->
        <div class="wall">
          <div class="wall-grid" id="wallGrid"></div>
        </div>
      </section>
    </div>

    <div style="height:6px"></div>
  </div>

  <footer>Â© Copyright 2025 MYâ€˜s System</footer>

  <!-- è©³æƒ…ï¼ˆå”¯è®€ï¼‰ -->
  <div id="detailOverlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="detailTitle">
    <div class="dialog">
      <h3 id="detailTitle">ç¥ç¦å…§å®¹</h3>
      <div class="detail">
        <div id="detailHTML"></div>
        <img id="detailSig" class="sig" alt="signature">
      </div>
      <div class="dlg-actions"><button id="detailClose">é—œé–‰</button></div>
    </div>
  </div>

<script>
/* ================= åŸºæœ¬èˆ‡æ¸¬è©¦ ================= */
const TEST_MODE = true;
const PLACEHOLDER='åœ¨æ­¤å¯«ä¸‹ä½ å°æ–°äººçš„ç¥ç¦â€¦ï¼ˆå¯é¸å­—å¾ŒæŒ‰ä¸Šæ–¹çš„ç²—é«”ï¼æ–œé«”ï¼åº•ç·šï¼é¡è‰²ï¼æ”¾å¤§ï¼ç¸®å°ï¼‰ğŸ’';

const BRIDE_NAME = 'å°ç¾';
const GROOM_NAME = 'å°å¸¥';

let currentSide = 'ALL';
let mockRole    = 'GROOM';
let signatureDataURL = '';

const editor = document.getElementById('editor');
const wallGrid = document.getElementById('wallGrid');
const statusEl = document.getElementById('status');

function setStatus(m){ statusEl.textContent = m + (TEST_MODE ? 'ï¼ˆæ¸¬è©¦ï¼‰' : ''); }

/* placeholder */
function showPlaceholder(){ editor.setAttribute('data-empty',''); editor.innerHTML=PLACEHOLDER; }
editor.addEventListener('focus',()=>{ if(editor.hasAttribute('data-empty')){ editor.innerHTML=''; editor.removeAttribute('data-empty'); }});
editor.addEventListener('blur',()=>{ if(!editor.textContent.trim()) showPlaceholder(); });

/* å·¥å…·åˆ— */
function exec(cmd){ if(editor.hasAttribute('data-empty')) return; document.execCommand(cmd,false,null); editor.focus(); }
document.getElementById('btnBold').onclick=()=>exec('bold');
document.getElementById('btnItalic').onclick=()=>exec('italic');
document.getElementById('btnUnderline').onclick=()=>exec('underline');
document.getElementById('colorPick').onchange=(e)=>{ const v=e.target.value; if(!editor.hasAttribute('data-empty')&&v){ document.execCommand('foreColor',false,v); editor.focus(); } e.target.blur(); };

let globalScale=1;
function setGlobal(sc){ globalScale=Math.max(0.7,Math.min(1.7,sc)); editor.style.setProperty('--editor-zoom',globalScale+'rem'); }
function wrapSel(cls){
  if(editor.hasAttribute('data-empty')) return false;
  const sel=window.getSelection(); if(!sel.rangeCount) return false;
  const r=sel.getRangeAt(0); if(r.collapsed) return false;
  const span=document.createElement('span'); span.className=cls;
  try{ r.surroundContents(span); }catch(_){ const f=r.extractContents(); span.appendChild(f); r.insertNode(span); }
  const s2=window.getSelection(); s2.removeAllRanges(); const nr=document.createRange(); nr.setStartAfter(span); nr.collapse(true); s2.addRange(nr);
  editor.focus(); return true;
}
document.getElementById('btnBigger').onclick=()=>{ if(!wrapSel('fs-up-1')) setGlobal(globalScale+0.06); };
document.getElementById('btnSmaller').onclick=()=>{ if(!wrapSel('fs-down-1')) setGlobal(globalScale-0.06); };

/* ç°½åï¼ˆæ¸¬è©¦å…ˆç”¨å‡çš„ç¤ºæ„åœ–ï¼‰ */
document.getElementById('chipSign').addEventListener('click', async ()=>{
  const ok = confirm('ï¼ˆæ¸¬è©¦ï¼‰æŒ‰ã€Œç¢ºå®šã€æ¨¡æ“¬å·²ç°½åï¼Œæœƒæ”¾å…¥ç¤ºæ„åœ–ã€‚');
  if(ok){
    signatureDataURL = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2P8z/C/HwAFGgKcYc3lJwAAAABJRU5ErkJggg==';
    const img=document.getElementById('signThumb');
    img.src='./assets/wishing.png'; // æ­£å¼ç‰ˆæœƒæ”¾ canvas è¼¸å‡ºçš„ dataURL
    document.getElementById('chipSign').classList.add('has-img');
  }
});

/* å´æ¬„ç¯©é¸ */
document.querySelectorAll('.side-btn[data-side]').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.side-btn[data-side]').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentSide = btn.dataset.side;
    renderWall();
  });
});
document.getElementById('mockMale').onclick = ()=>{ mockRole='GROOM'; setStatus('èº«åˆ†ï¼šæ–°éƒè¦ªå‹'); refreshCoupleBadge(); };
document.getElementById('mockFemale').onclick = ()=>{ mockRole='BRIDE'; setStatus('èº«åˆ†ï¼šæ–°å¨˜è¦ªå‹'); refreshCoupleBadge(); };

/* æ–°äººåå­—ï¼ˆæ¸¬è©¦å¸¶å…¥ï¼‰ */
function refreshCoupleBadge(){
  const name = mockRole==='GROOM' ? GROOM_NAME : BRIDE_NAME;
  document.getElementById('brideLabel').textContent = 'æ–°äººï¼š' + name;
}

/* é€å‡ºåˆ° localStorage â†’ ç‰† */
document.getElementById('btnSubmit').addEventListener('click', async ()=>{
  if(editor.hasAttribute('data-empty') || !editor.textContent.trim()){ alert('è«‹å¯«ä¸‹ç¥ç¦å…§å®¹å”·ï½'); return; }
  const contentHTML = editor.innerHTML.trim();
  const id = 'test_' + Date.now();

  const item = {
    id, timestamp: new Date().toISOString(),
    lineId: 'TEST', side: mockRole, authorName: (mockRole==='GROOM'?'æ–°éƒå‹':'æ–°å¨˜å‹'),
    message: contentHTML, signatureFileUrl: signatureDataURL || '',
    canEdit: true, status: 'ok'
  };
  const list = JSON.parse(localStorage.getItem('blessings')||'[]');
  list.unshift(item); localStorage.setItem('blessings', JSON.stringify(list));

  setStatus('âœ… ç¥ç¦å·²é€å‡ºï¼ˆæ¸¬è©¦ï¼‰');
  // æ¸…ç©º
  showPlaceholder();
  signatureDataURL='';
  document.getElementById('chipSign').classList.remove('has-img');
  document.getElementById('signThumb').removeAttribute('src');

  renderWall();
});

/* ç¥ç¦ç‰† render */
function renderWall(){
  const list = JSON.parse(localStorage.getItem('blessings')||'[]');
  let rows = list;
  if(currentSide!=='ALL') rows = rows.filter(r=>r.side===currentSide);
  wallGrid.innerHTML = rows.map(r=>{
    const sideLabel = r.side==='GROOM'?'æ–°éƒ':'æ–°å¨˜';
    const plain = stripHTML(r.message).replace(/\s+/g,' ').trim();
    return `
      <div class="wall-card" data-id="${r.id}">
        <div class="meta"><span>${sideLabel}</span><span>${new Date(r.timestamp).toLocaleString()}</span></div>
        <div class="txt">${escapeHTML(plain)}</div>
        ${r.signatureFileUrl ? `<img class="sig" src="${r.signatureFileUrl || './assets/wishing.png'}" alt="">` : ''}
      </div>
    `;
  }).join('') || `<p style="-webkit-text-stroke:0;text-shadow:none;color:#6b5e52;opacity:.8;text-align:center;margin:12px 0">å°šç„¡ç¥ç¦ï¼Œå¿«ä¾†å¯«ç¬¬ä¸€å¼µå§ï¼</p>`;

  // ç¶é»é–‹è©³æƒ…
  document.querySelectorAll('.wall-card').forEach(card=>{
    card.addEventListener('click',()=>{
      const id = card.dataset.id;
      const list = JSON.parse(localStorage.getItem('blessings')||'[]');
      const it = list.find(x=>x.id===id);
      if(!it) return;
      document.getElementById('detailHTML').innerHTML = it.message;
      const sig = document.getElementById('detailSig');
      if(it.signatureFileUrl){ sig.src = it.signatureFileUrl; sig.style.display='block'; } else { sig.style.display='none'; }
      document.getElementById('detailOverlay').classList.add('show');
    });
  });
}

/* å°å·¥å…· */
function stripHTML(html){ const div=document.createElement('div'); div.innerHTML=html; return div.textContent||div.innerText||''; }
function escapeHTML(s){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

/* è©³æƒ…é—œé–‰ */
document.getElementById('detailClose').onclick=()=>document.getElementById('detailOverlay').classList.remove('show');

/* å•Ÿå‹• */
window.addEventListener('DOMContentLoaded', ()=>{
  setStatus('å·²å°±ç·’');
  showPlaceholder();
  refreshCoupleBadge();
  renderWall();
});
</script>
</body>
</html>
